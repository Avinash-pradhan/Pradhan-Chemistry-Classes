{% extends 'base.html' %}

{% block content %}
<div class="card">
    <span class="eyebrow">Secure Payment</span>
    <h2>Complete Payment</h2>
    <p class="muted">Amount to pay: &#8377;{{ admission.fee_amount }}</p>

    <button id="pay-button" class="btn">Pay with Razorpay</button>

    <form id="payment-form" method="post" action="{% url 'payment_verify' %}">
        {% csrf_token %}
        <input type="hidden" name="razorpay_payment_id" id="razorpay_payment_id">
        <input type="hidden" name="razorpay_order_id" id="razorpay_order_id">
        <input type="hidden" name="razorpay_signature" id="razorpay_signature">
    </form>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    var options = {
        key: "{{ razorpay_key_id }}",
        amount: "{{ razorpay_amount }}",
        currency: "INR",
        name: "{{ razorpay_name }}",
        description: "Admission Fee",
        order_id: "{{ razorpay_order_id }}",
        prefill: {
            name: "{{ admission.student.name }}",
            contact: "{{ admission.student.mobile }}"
        },
        handler: function (response) {
            document.getElementById("razorpay_payment_id").value = response.razorpay_payment_id;
            document.getElementById("razorpay_order_id").value = response.razorpay_order_id;
            document.getElementById("razorpay_signature").value = response.razorpay_signature;
            document.getElementById("payment-form").submit();
        }
    };
    var rzp = new Razorpay(options);
    document.getElementById("pay-button").onclick = function (e) {
        rzp.open();
        e.preventDefault();
    };
</script>
{% endblock %}
